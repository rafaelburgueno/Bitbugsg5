{% extends 'core/base.html' %}
{% load static %}
{% block title %}Pedidos Farmacia{% endblock %}
{% block content %}

{% comment %} {% include 'pedidos/includes/pedidos_menu.html' %} {% endcomment %}

<main role="main">
  <div class="container mb-4 pt-2">

    {% comment %}
    Mensaje de confirmacion por una edicion exitosa
    {% endcomment %}
    {% if request.GET %}
      <div class="alert alert-success alert-dismissible show desvanecer" role="alert">
        {% if 'procesado' in request.GET %}
          El pedido fue procesado correctamente.
        {% elif 'borrado' in request.GET %}
          El pedido fue borrado correctamente.
        {% endif %}
        <button type="button" class="close" data-dismiss="alert" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
    
    {% endif %}


    {% comment %} las siguientes 'pipes' le dice que campo usar para ordenar los resultados(por urgencia y en reversa: '|dictsort:"urgencia" reversed ') {% endcomment %}
    {% for pedido in pedidos_list %}

      <div class="card text-white  mb-5 color2" >
        <form>
          <div class="card-headerr p-2">
            {% comment %} <a href="{% url 'pedidos:pedido' pedido.id %}" style="color:white;"> {% endcomment %}
            
            
            {% comment %} 
            Visualiza la urgencia del pedido (rutina, urgente)
            {% endcomment %}
            {% if pedido.urgencia == 'no urgente' %}
              <span class="badge badge-success float-left">rutina</span>
            {% elif pedido.urgencia == 'urgente' %}
              <span class="badge badge-danger float-left">urgente</span>
            {% else %}
              <span class="badge badge-warning float-left">modificado</span>
            {% endif %}


            {% comment %} 
            Visualizar el estado del pedido (pendiente, en proceso o para retirar)
            {% endcomment %}
            {% if pedido.estado == 'pendiente' %}
            <span class="badge badge-danger float-right">{{pedido.estado}}</span>
            {% elif pedido.estado == 'en proceso' %}
            <span class="badge badge-warning float-right">{{pedido.estado}}</span>
            {% elif pedido.estado == 'para retirar' %}
            <span class="badge badge-success float-right">{{pedido.estado}}</span>
            {% endif %}


            {% comment %}
            Visualiza el id del pedido (podria ocultarse, no es muy relevante)
            {% endcomment %}
            <p class="text-center"><span class="badge badge-pill badge-secondary">id:{{pedido.id}}</span></p>


            {% comment %}
            Visualiza la sala, la cama y el nombre del paciente
            {% endcomment %}
            <h6 class="text-center mt-3">{{pedido.cama}} - {{pedido.paciente}}</h6>

          </div>

          <hr class="my-0 mx-3">
          
          <div class="card-body">

            <button type="button" class="btn btn-block btn-outline-light mb-1" data-toggle="collapse" data-target="#{{pedido.id}}-insumos">
              Insumos <i class="fa fa-sort-desc"></i>
            </button>
            <div id="{{pedido.id}}-insumos" class="collapse">
              <ul class="list-group text-dark mb-3">
                {% for insumo in pedido.insumos_as_list %}
                  <li class="list-group-item">{{insumo}}</li>
                {% endfor %}
              </ul>
            </div>


            <button type="button" class="btn btn-block btn-outline-light mb-1 mt-2" data-toggle="collapse" data-target="#{{pedido.id}}-fechas">
              Fechas <i class="fa fa-sort-desc"></i>
            </button>
            <div id="{{pedido.id}}-fechas" class="collapse">
              <ul class="list-group text-dark">
                <li class="list-group-item small p-1">Solicitado por: {{pedido.solicitante}} - {{pedido.created}}</li>
                <li class="list-group-item small p-1">Procesado por: {{pedido.procesante}} - {{pedido.fecha_procesamiento}}</li>
                <li class="list-group-item small p-1">Despachable: {{pedido.fecha_despachable}}</li>
                <li class="list-group-item small p-1">Retirado por: {{pedido.retirante}} - {{pedido.fecha_despacho}}</li>
              </ul>
            </div>
            
            <hr class="my-4 mx-0">

            {% if 'pedidos.change_pedidos' in request.user.get_group_permissions and pedido.estado == 'pendiente' %}
            <a href="{% url 'pedidos:procesar' pedido.id %}" class="btn btn-block btn-outline-light mx-auto" style="width:70%;">Procesar</a>
            {% endif %}

            {% if 'pedidos.delete_pedidos' in request.user.get_group_permissions %}    
            <a href="{% url 'pedidos:delete' pedido.id %}" class="btn btn-block btn-outline-warning mx-auto" style="width:70%;">Borrar</a>
            {% endif %}


            
          </div>

        </form>

      </div>


    {% endfor %}
  </div>
</main>
{% endblock %}




